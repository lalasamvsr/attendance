<!DOCTYPE html>
<html>
<head>
<title>Attendance Report</title>

<style>
body{
    font-family: Arial;
    background:#f4f6f8;
    padding:20px;
}

select,button,input{
    padding:8px;
    margin:8px 5px 8px 0;
}

table{
    border-collapse:collapse;
    width:100%;
    background:#fff;
    margin-top:15px;
}

th,td{
    border:1px solid #ccc;
    padding:8px;
    text-align:center;
}

th{
    background:#eef2ff;
}

.summary{
    display:flex;
    gap:20px;
    margin:12px 0;
}

.card{
    background:white;
    padding:10px 18px;
    border-radius:6px;
    font-weight:bold;
}

.present{ color:green; }
.absent{ color:red; }

.back{
    margin-top:15px;
    display:inline-block;
}
</style>
</head>

<body>

<h3>Attendance Report {% if subject %} - {{ subject }} {% endif %}</h3>

<!-- ðŸ”Ž FILTER FORM -->
<form method="GET" action="/week-report">

    <!-- REQUIRED CONTEXT -->
    <input type="hidden" name="schedule_id" value="{{ schedule_id }}">

    <label>Select Date:</label>
    <input type="date" name="date" value="{{ selected_date }}" required>

    <label>Status:</label>
    <select name="filter">
        <option value="All" {% if filter=='All' %}selected{% endif %}>All</option>
        <option value="Present" {% if filter=='Present' %}selected{% endif %}>Present</option>
        <option value="Absent" {% if filter=='Absent' %}selected{% endif %}>Absent</option>
    </select>

    <button type="submit">View Report</button>
</form>

{% if report is not none %}

<!-- ðŸ“Š SUMMARY -->
<div class="summary">
    <div class="card present">Present: {{ present_count }}</div>
    <div class="card absent">Absent: {{ absent_count }}</div>
</div>

<!-- ðŸ“‹ TABLE -->
<table>
<tr>
    <th>Roll No</th>
    <th>Name</th>
    <th>Status</th>
</tr>

{% if report %}
    {% for r in report %}
    <tr>
        <td>{{ r.roll }}</td>
        <td>{{ r.name }}</td>
        <td class="{% if r.status == 'Present' %}present{% else %}absent{% endif %}">
            {{ r.status }}
        </td>
    </tr>
    {% endfor %}
{% else %}
    <tr>
        <td colspan="3">No attendance records found for this date.</td>
    </tr>
{% endif %}

</table>

<!-- â¬‡ï¸ EXPORT -->
<form method="GET" action="/download-excel">
    <input type="hidden" name="date" value="{{ selected_date }}">
    <input type="hidden" name="schedule_id" value="{{ schedule_id }}">
    <button type="submit">â¬‡ Download as Excel</button>
</form>

{% endif %}

<br>

<!-- ðŸ”™ BACK BUTTON -->
{% if session.role == 'faculty' %}
<a href="/faculty-dashboard" class="back">â¬… Back</a>
{% else %}
<a href="/admin-dashboard" class="back">â¬… Back</a>
{% endif %}

</body>
</html>
